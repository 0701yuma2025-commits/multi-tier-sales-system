<!DOCTYPE html>
<html lang="ja">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>è©³ç´°åˆ†æãƒ€ãƒƒã‚·ãƒ¥ãƒœãƒ¼ãƒ‰ - å¤šæ®µéšå–¶æ¥­ä»£ç†åº—ç®¡ç†ã‚·ã‚¹ãƒ†ãƒ </title>
    <script src="js/auth-check-simple.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/chart.js@4.4.1/dist/chart.umd.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/chartjs-adapter-date-fns@3.0.0/dist/chartjs-adapter-date-fns.bundle.min.js"></script>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }
        
        body {
            font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, sans-serif;
            background-color: #f3f4f6;
            min-height: 100vh;
        }
        
        /* ãƒ˜ãƒƒãƒ€ãƒ¼ */
        .header {
            background-color: white;
            border-bottom: 1px solid #e5e7eb;
            padding: 16px 24px;
            display: flex;
            justify-content: space-between;
            align-items: center;
            box-shadow: 0 1px 3px rgba(0, 0, 0, 0.1);
        }
        
        .header h1 {
            font-size: 24px;
            color: #1f2937;
        }
        
        .header-controls {
            display: flex;
            gap: 12px;
            align-items: center;
        }
        
        .date-range-selector {
            display: flex;
            gap: 8px;
            align-items: center;
            background-color: #f3f4f6;
            padding: 8px 12px;
            border-radius: 8px;
        }
        
        .date-input {
            border: none;
            background: transparent;
            font-size: 14px;
            color: #4b5563;
            cursor: pointer;
        }
        
        .back-btn {
            padding: 8px 16px;
            background-color: #6366f1;
            color: white;
            border: none;
            border-radius: 6px;
            cursor: pointer;
            font-size: 14px;
            text-decoration: none;
            display: inline-block;
        }
        
        .back-btn:hover {
            background-color: #4f46e5;
        }
        
        /* ãƒ•ã‚£ãƒ«ã‚¿ãƒ¼ã‚»ã‚¯ã‚·ãƒ§ãƒ³ */
        .filters-section {
            background-color: white;
            padding: 20px 24px;
            border-bottom: 1px solid #e5e7eb;
            display: flex;
            gap: 16px;
            flex-wrap: wrap;
            align-items: center;
        }
        
        .filter-group {
            display: flex;
            flex-direction: column;
            gap: 4px;
        }
        
        .filter-label {
            font-size: 12px;
            color: #6b7280;
            font-weight: 500;
        }
        
        .filter-select {
            padding: 8px 12px;
            border: 1px solid #d1d5db;
            border-radius: 6px;
            background-color: white;
            font-size: 14px;
            color: #1f2937;
            cursor: pointer;
        }
        
        .apply-filters-btn {
            padding: 8px 20px;
            background-color: #10b981;
            color: white;
            border: none;
            border-radius: 6px;
            cursor: pointer;
            font-size: 14px;
            align-self: flex-end;
            margin-left: auto;
        }
        
        .apply-filters-btn:hover {
            background-color: #059669;
        }
        
        /* ãƒ¡ãƒˆãƒªã‚¯ã‚¹ã‚«ãƒ¼ãƒ‰ */
        .metrics-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 16px;
            padding: 24px;
        }
        
        .metric-card {
            background: white;
            border-radius: 8px;
            padding: 20px;
            box-shadow: 0 1px 3px rgba(0, 0, 0, 0.1);
        }
        
        .metric-label {
            color: #6b7280;
            font-size: 12px;
            font-weight: 500;
            margin-bottom: 4px;
        }
        
        .metric-value {
            font-size: 24px;
            font-weight: 700;
            color: #1f2937;
        }
        
        .metric-comparison {
            font-size: 12px;
            margin-top: 4px;
        }
        
        .metric-comparison.positive {
            color: #10b981;
        }
        
        .metric-comparison.negative {
            color: #ef4444;
        }
        
        /* ãƒãƒ£ãƒ¼ãƒˆã‚³ãƒ³ãƒ†ãƒŠ */
        .charts-container {
            padding: 0 24px 24px;
        }
        
        .chart-section {
            background: white;
            border-radius: 12px;
            padding: 24px;
            box-shadow: 0 1px 3px rgba(0, 0, 0, 0.1);
            margin-bottom: 24px;
        }
        
        .chart-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 20px;
        }
        
        .chart-title {
            font-size: 18px;
            font-weight: 600;
            color: #1f2937;
        }
        
        .chart-options {
            display: flex;
            gap: 8px;
        }
        
        .chart-btn {
            padding: 6px 12px;
            background-color: #f3f4f6;
            border: none;
            border-radius: 6px;
            font-size: 12px;
            cursor: pointer;
            transition: background-color 0.2s;
        }
        
        .chart-btn.active {
            background-color: #6366f1;
            color: white;
        }
        
        .chart-wrapper {
            position: relative;
            height: 400px;
        }
        
        .chart-wrapper.small {
            height: 300px;
        }
        
        /* ãƒ†ãƒ¼ãƒ–ãƒ« */
        .table-section {
            background: white;
            border-radius: 12px;
            padding: 24px;
            box-shadow: 0 1px 3px rgba(0, 0, 0, 0.1);
            margin-bottom: 24px;
        }
        
        .table-wrapper {
            overflow-x: auto;
        }
        
        table {
            width: 100%;
            border-collapse: collapse;
        }
        
        th {
            text-align: left;
            padding: 12px;
            border-bottom: 2px solid #e5e7eb;
            color: #4b5563;
            font-weight: 600;
            font-size: 14px;
            white-space: nowrap;
        }
        
        td {
            padding: 12px;
            border-bottom: 1px solid #f3f4f6;
            color: #1f2937;
            font-size: 14px;
        }
        
        .comparison-tables {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(500px, 1fr));
            gap: 24px;
        }
        
        /* ã‚¤ãƒ³ã‚µã‚¤ãƒˆã‚«ãƒ¼ãƒ‰ */
        .insights-section {
            padding: 0 24px 24px;
        }
        
        .insights-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(350px, 1fr));
            gap: 16px;
        }
        
        .insight-card {
            background: white;
            border-radius: 8px;
            padding: 20px;
            box-shadow: 0 1px 3px rgba(0, 0, 0, 0.1);
            border-left: 4px solid #6366f1;
        }
        
        .insight-title {
            font-weight: 600;
            color: #1f2937;
            margin-bottom: 8px;
            display: flex;
            align-items: center;
            gap: 8px;
        }
        
        .insight-icon {
            font-size: 20px;
        }
        
        .insight-content {
            color: #4b5563;
            font-size: 14px;
            line-height: 1.6;
        }
        
        .insight-action {
            margin-top: 12px;
            color: #6366f1;
            font-size: 14px;
            font-weight: 500;
            cursor: pointer;
        }
        
        .insight-action:hover {
            text-decoration: underline;
        }
    </style>
</head>
<body>
    <!-- ãƒ˜ãƒƒãƒ€ãƒ¼ -->
    <header class="header">
        <h1>ğŸ“Š è©³ç´°åˆ†æãƒ€ãƒƒã‚·ãƒ¥ãƒœãƒ¼ãƒ‰</h1>
        <div class="header-controls">
            <div class="date-range-selector">
                <input type="date" class="date-input" id="startDate" value="2024-02-01">
                <span>ã€œ</span>
                <input type="date" class="date-input" id="endDate" value="2024-03-31">
            </div>
            <a href="dashboard-admin.html" class="back-btn">â† ãƒ€ãƒƒã‚·ãƒ¥ãƒœãƒ¼ãƒ‰ã«æˆ»ã‚‹</a>
        </div>
    </header>
    
    <!-- ãƒŠãƒ“ã‚²ãƒ¼ã‚·ãƒ§ãƒ³ -->
    <nav style="background-color: white; border-bottom: 1px solid #e5e7eb; padding: 0 24px;">
        <ul style="display: flex; list-style: none; gap: 32px; margin: 0; padding: 0;">
            <li style="padding: 16px 0; color: #6b7280; font-size: 15px; cursor: pointer;" onclick="location.href='/dashboard-admin.html'">ãƒ€ãƒƒã‚·ãƒ¥ãƒœãƒ¼ãƒ‰</li>
            <li style="padding: 16px 0; color: #3b82f6; font-weight: 500; font-size: 15px; cursor: pointer; position: relative;">ğŸ—’ï¸ è©³ç´°åˆ†æ<span style="position: absolute; bottom: 0; left: 0; right: 0; height: 3px; background-color: #3b82f6;"></span></li>
            <li style="padding: 16px 0; color: #6b7280; font-size: 15px; cursor: pointer;" onclick="location.href='/agencies-admin.html'">ä»£ç†åº—ç®¡ç†</li>
            <li style="padding: 16px 0; color: #6b7280; font-size: 15px; cursor: pointer;" onclick="location.href='/sales-functions.html'">å£²ä¸Šç®¡ç†</li>
            <li style="padding: 16px 0; color: #6b7280; font-size: 15px; cursor: pointer;" onclick="location.href='/commissions-admin.html'">å ±é…¬ç®¡ç†</li>
        </ul>
    </nav>
    
    <!-- ãƒ•ã‚£ãƒ«ã‚¿ãƒ¼ã‚»ã‚¯ã‚·ãƒ§ãƒ³ -->
    <div class="filters-section">
        <div class="filter-group">
            <label class="filter-label">ä»£ç†åº—éšå±¤</label>
            <select class="filter-select">
                <option value="">ã™ã¹ã¦</option>
                <option value="1">Tier 1</option>
                <option value="2">Tier 2</option>
                <option value="3">Tier 3</option>
                <option value="4">Tier 4</option>
            </select>
        </div>
        
        <div class="filter-group">
            <label class="filter-label">åœ°åŸŸ</label>
            <select class="filter-select">
                <option value="">ã™ã¹ã¦</option>
                <option value="kanto">é–¢æ±</option>
                <option value="kansai">é–¢è¥¿</option>
                <option value="chubu">ä¸­éƒ¨</option>
                <option value="tohoku">æ±åŒ—</option>
                <option value="kyushu">ä¹å·</option>
            </select>
        </div>
        
        <div class="filter-group">
            <label class="filter-label">å•†å“ã‚«ãƒ†ã‚´ãƒª</label>
            <select class="filter-select">
                <option value="">ã™ã¹ã¦</option>
                <option value="premium">ãƒ—ãƒ¬ãƒŸã‚¢ãƒ ãƒ—ãƒ©ãƒ³</option>
                <option value="standard">ã‚¹ã‚¿ãƒ³ãƒ€ãƒ¼ãƒ‰ãƒ—ãƒ©ãƒ³</option>
                <option value="basic">ãƒ™ãƒ¼ã‚·ãƒƒã‚¯ãƒ—ãƒ©ãƒ³</option>
            </select>
        </div>
        
        <div class="filter-group">
            <label class="filter-label">ä»£ç†åº—è¦æ¨¡</label>
            <select class="filter-select">
                <option value="">ã™ã¹ã¦</option>
                <option value="large">å¤§è¦æ¨¡ï¼ˆæœˆå•†500ä¸‡å††ä»¥ä¸Šï¼‰</option>
                <option value="medium">ä¸­è¦æ¨¡ï¼ˆæœˆå•†100-500ä¸‡å††ï¼‰</option>
                <option value="small">å°è¦æ¨¡ï¼ˆæœˆå•†100ä¸‡å††æœªæº€ï¼‰</option>
            </select>
        </div>
        
        <button class="apply-filters-btn" onclick="applyFilters()">ãƒ•ã‚£ãƒ«ã‚¿é©ç”¨</button>
    </div>
    
    <!-- ãƒ¡ãƒˆãƒªã‚¯ã‚¹ã‚«ãƒ¼ãƒ‰ -->
    <div class="metrics-grid">
        <div class="metric-card">
            <div class="metric-label">å¹³å‡å¥‘ç´„å˜ä¾¡</div>
            <div class="metric-value">Â¥85,420</div>
            <div class="metric-comparison positive">â†‘ +12.3% å‰æœŸæ¯”</div>
        </div>
        
        <div class="metric-card">
            <div class="metric-label">LTVï¼ˆé¡§å®¢ç”Ÿæ¶¯ä¾¡å€¤ï¼‰</div>
            <div class="metric-value">Â¥428,500</div>
            <div class="metric-comparison positive">â†‘ +8.7% å‰æœŸæ¯”</div>
        </div>
        
        <div class="metric-card">
            <div class="metric-label">é¡§å®¢ç²å¾—ã‚³ã‚¹ãƒˆï¼ˆCACï¼‰</div>
            <div class="metric-value">Â¥32,100</div>
            <div class="metric-comparison negative">â†‘ +3.2% å‰æœŸæ¯”</div>
        </div>
        
        <div class="metric-card">
            <div class="metric-label">ç¶™ç¶šç‡</div>
            <div class="metric-value">87.3%</div>
            <div class="metric-comparison positive">â†‘ +2.1% å‰æœŸæ¯”</div>
        </div>
        
        <div class="metric-card">
            <div class="metric-label">ROI</div>
            <div class="metric-value">234%</div>
            <div class="metric-comparison positive">â†‘ +18% å‰æœŸæ¯”</div>
        </div>
        
        <div class="metric-card">
            <div class="metric-label">ãƒªãƒ¼ãƒ‰â†’æˆç´„ç‡</div>
            <div class="metric-value">14.8%</div>
            <div class="metric-comparison positive">â†‘ +1.2% å‰æœŸæ¯”</div>
        </div>
    </div>
    
    <!-- ãƒãƒ£ãƒ¼ãƒˆã‚»ã‚¯ã‚·ãƒ§ãƒ³ -->
    <div class="charts-container">
        <!-- ã‚³ãƒ›ãƒ¼ãƒˆåˆ†æ -->
        <div class="chart-section">
            <div class="chart-header">
                <h2 class="chart-title">ã‚³ãƒ›ãƒ¼ãƒˆåˆ†æ - ä»£ç†åº—ãƒ‘ãƒ•ã‚©ãƒ¼ãƒãƒ³ã‚¹</h2>
                <div class="chart-options">
                    <button class="chart-btn active" onclick="switchCohortView('revenue')">å£²ä¸Š</button>
                    <button class="chart-btn" onclick="switchCohortView('retention')">ç¶™ç¶šç‡</button>
                    <button class="chart-btn" onclick="switchCohortView('growth')">æˆé•·ç‡</button>
                </div>
            </div>
            <div class="chart-wrapper">
                <canvas id="cohortChart"></canvas>
            </div>
        </div>
        
        <!-- ãƒ•ã‚¡ãƒãƒ«åˆ†æ -->
        <div class="chart-section">
            <div class="chart-header">
                <h2 class="chart-title">ã‚»ãƒ¼ãƒ«ã‚¹ãƒ•ã‚¡ãƒãƒ«åˆ†æ</h2>
                <div class="chart-options">
                    <button class="chart-btn active" onclick="switchFunnelPeriod('month')">ä»Šæœˆ</button>
                    <button class="chart-btn" onclick="switchFunnelPeriod('quarter')">ä»Šå››åŠæœŸ</button>
                    <button class="chart-btn" onclick="switchFunnelPeriod('year')">ä»Šå¹´</button>
                </div>
            </div>
            <div class="chart-wrapper small">
                <canvas id="funnelChart"></canvas>
            </div>
        </div>
        
        <!-- ãƒ’ãƒ¼ãƒˆãƒãƒƒãƒ— -->
        <div class="chart-section">
            <div class="chart-header">
                <h2 class="chart-title">æ™‚é–“åˆ¥å£²ä¸Šãƒ’ãƒ¼ãƒˆãƒãƒƒãƒ—</h2>
            </div>
            <div class="chart-wrapper">
                <canvas id="heatmapChart"></canvas>
            </div>
        </div>
    </div>
    
    <!-- æ¯”è¼ƒãƒ†ãƒ¼ãƒ–ãƒ« -->
    <div class="comparison-tables">
        <div class="table-section">
            <div class="chart-header">
                <h2 class="chart-title">ãƒˆãƒƒãƒ—ãƒ‘ãƒ•ã‚©ãƒ¼ãƒãƒ¼åˆ†æ</h2>
            </div>
            <div class="table-wrapper">
                <table>
                    <thead>
                        <tr>
                            <th>ä»£ç†åº—å</th>
                            <th>æœˆé–“å£²ä¸Š</th>
                            <th>æˆç´„ç‡</th>
                            <th>æˆé•·ç‡</th>
                            <th>åŠ¹ç‡ã‚¹ã‚³ã‚¢</th>
                        </tr>
                    </thead>
                    <tbody>
                        <tr>
                            <td>ABCå•†äº‹</td>
                            <td>Â¥3,250,000</td>
                            <td>23.5%</td>
                            <td><span style="color: #10b981;">+45%</span></td>
                            <td>94/100</td>
                        </tr>
                        <tr>
                            <td>XYZã‚¨ãƒ¼ã‚¸ã‚§ãƒ³ã‚·ãƒ¼</td>
                            <td>Â¥2,890,000</td>
                            <td>21.2%</td>
                            <td><span style="color: #10b981;">+38%</span></td>
                            <td>91/100</td>
                        </tr>
                        <tr>
                            <td>å±±ç”°å–¶æ¥­ä¼ç”»</td>
                            <td>Â¥2,450,000</td>
                            <td>19.8%</td>
                            <td><span style="color: #10b981;">+32%</span></td>
                            <td>88/100</td>
                        </tr>
                    </tbody>
                </table>
            </div>
        </div>
        
        <div class="table-section">
            <div class="chart-header">
                <h2 class="chart-title">å•†å“åˆ¥ãƒ‘ãƒ•ã‚©ãƒ¼ãƒãƒ³ã‚¹</h2>
            </div>
            <div class="table-wrapper">
                <table>
                    <thead>
                        <tr>
                            <th>å•†å“ã‚«ãƒ†ã‚´ãƒª</th>
                            <th>è²©å£²æ•°</th>
                            <th>å£²ä¸Šè²¢çŒ®åº¦</th>
                            <th>åˆ©ç›Šç‡</th>
                            <th>ãƒˆãƒ¬ãƒ³ãƒ‰</th>
                        </tr>
                    </thead>
                    <tbody>
                        <tr>
                            <td>ãƒ—ãƒ¬ãƒŸã‚¢ãƒ ãƒ—ãƒ©ãƒ³</td>
                            <td>124</td>
                            <td>45.2%</td>
                            <td>38.5%</td>
                            <td><span style="color: #10b981;">â†‘</span></td>
                        </tr>
                        <tr>
                            <td>ã‚¹ã‚¿ãƒ³ãƒ€ãƒ¼ãƒ‰ãƒ—ãƒ©ãƒ³</td>
                            <td>298</td>
                            <td>35.8%</td>
                            <td>32.1%</td>
                            <td><span style="color: #f59e0b;">â†’</span></td>
                        </tr>
                        <tr>
                            <td>ãƒ™ãƒ¼ã‚·ãƒƒã‚¯ãƒ—ãƒ©ãƒ³</td>
                            <td>456</td>
                            <td>19.0%</td>
                            <td>28.3%</td>
                            <td><span style="color: #ef4444;">â†“</span></td>
                        </tr>
                    </tbody>
                </table>
            </div>
        </div>
    </div>
    
    <!-- ã‚¤ãƒ³ã‚µã‚¤ãƒˆã‚»ã‚¯ã‚·ãƒ§ãƒ³ -->
    <div class="insights-section">
        <h2 style="font-size: 20px; font-weight: 600; color: #1f2937; margin-bottom: 16px;">AIã«ã‚ˆã‚‹åˆ†æã‚¤ãƒ³ã‚µã‚¤ãƒˆ</h2>
        <div class="insights-grid">
            <div class="insight-card">
                <div class="insight-title">
                    <span class="insight-icon">ğŸ’¡</span>
                    æˆé•·æ©Ÿä¼šã®ç™ºè¦‹
                </div>
                <div class="insight-content">
                    é–¢æ±ã‚¨ãƒªã‚¢ã®Tier 2ä»£ç†åº—ãŒéå»3ãƒ¶æœˆã§å¹³å‡35%ã®æˆé•·ã‚’é”æˆã€‚ç‰¹ã«ä¸­å°ä¼æ¥­å‘ã‘ã®ã‚¢ãƒ—ãƒ­ãƒ¼ãƒãŒåŠ¹æœçš„ã§ã™ã€‚
                </div>
                <div class="insight-action">è©³ç´°ãƒ¬ãƒãƒ¼ãƒˆã‚’è¦‹ã‚‹ â†’</div>
            </div>
            
            <div class="insight-card">
                <div class="insight-title">
                    <span class="insight-icon">âš ï¸</span>
                    æ”¹å–„ãŒå¿…è¦ãªã‚¨ãƒªã‚¢
                </div>
                <div class="insight-content">
                    ãƒ™ãƒ¼ã‚·ãƒƒã‚¯ãƒ—ãƒ©ãƒ³ã®ç¶™ç¶šç‡ãŒå‰æœˆæ¯”ã§5%ä½ä¸‹ã€‚ä¾¡æ ¼ç«¶äº‰åŠ›ã®è¦‹ç›´ã—ã¾ãŸã¯ä»˜åŠ ä¾¡å€¤ã®è¿½åŠ ãŒæ¨å¥¨ã•ã‚Œã¾ã™ã€‚
                </div>
                <div class="insight-action">æ”¹å–„è¨ˆç”»ã‚’ä½œæˆ â†’</div>
            </div>
            
            <div class="insight-card">
                <div class="insight-title">
                    <span class="insight-icon">ğŸ¯</span>
                    ãƒ‘ãƒ•ã‚©ãƒ¼ãƒãƒ³ã‚¹äºˆæ¸¬
                </div>
                <div class="insight-content">
                    ç¾åœ¨ã®ãƒˆãƒ¬ãƒ³ãƒ‰ãŒç¶šã‘ã°ã€Q2ã®å£²ä¸Šã¯å‰å¹´æ¯”+28%ã€ç·å ±é…¬é¡ã¯+32%ã®æˆé•·ãŒè¦‹è¾¼ã¾ã‚Œã¾ã™ã€‚
                </div>
                <div class="insight-action">äºˆæ¸¬è©³ç´°ã‚’ç¢ºèª â†’</div>
            </div>
            
            <div class="insight-card">
                <div class="insight-title">
                    <span class="insight-icon">ğŸ”</span>
                    ç•°å¸¸å€¤ã®æ¤œå‡º
                </div>
                <div class="insight-content">
                    ä¹å·ã‚¨ãƒªã‚¢ã§é€šå¸¸ã®3å€ã®æ–°è¦ç™»éŒ²ãŒç™ºç”Ÿã€‚åœ°åŸŸã‚­ãƒ£ãƒ³ãƒšãƒ¼ãƒ³ã®åŠ¹æœæ¸¬å®šã¨æ¨ªå±•é–‹ã®æ¤œè¨ã‚’æ¨å¥¨ã€‚
                </div>
                <div class="insight-action">åˆ†æãƒ¬ãƒãƒ¼ãƒˆã‚’è¦‹ã‚‹ â†’</div>
            </div>
        </div>
    </div>
    
    <script>
        // ã‚³ãƒ›ãƒ¼ãƒˆåˆ†æãƒãƒ£ãƒ¼ãƒˆ
        function initCohortChart() {
            const ctx = document.getElementById('cohortChart').getContext('2d');
            
            // ã‚³ãƒ›ãƒ¼ãƒˆãƒ‡ãƒ¼ã‚¿ã®ç”Ÿæˆ
            const months = ['10æœˆ', '11æœˆ', '12æœˆ', '1æœˆ', '2æœˆ', '3æœˆ'];
            const cohortData = [];
            
            // å„æœˆã®ã‚³ãƒ›ãƒ¼ãƒˆãƒ‡ãƒ¼ã‚¿ã‚’ç”Ÿæˆ
            for (let i = 0; i < 6; i++) {
                const data = [];
                for (let j = 0; j <= i; j++) {
                    // æ™‚é–“çµŒéã¨ã¨ã‚‚ã«æ¸›è¡°ã™ã‚‹å€¤ã‚’ç”Ÿæˆ
                    const baseValue = 100 - (j * 10) + (Math.random() * 10 - 5);
                    data.push(Math.max(0, baseValue));
                }
                cohortData.push(data);
            }
            
            window.cohortChart = new Chart(ctx, {
                type: 'line',
                data: {
                    labels: ['æœˆ0', 'æœˆ1', 'æœˆ2', 'æœˆ3', 'æœˆ4', 'æœˆ5'],
                    datasets: months.map((month, index) => ({
                        label: month + 'ç™»éŒ²',
                        data: cohortData[index],
                        borderColor: `hsl(${index * 60}, 70%, 50%)`,
                        backgroundColor: `hsla(${index * 60}, 70%, 50%, 0.1)`,
                        borderWidth: 2,
                        tension: 0.3
                    }))
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: false,
                    plugins: {
                        title: {
                            display: false
                        },
                        legend: {
                            position: 'right'
                        },
                        tooltip: {
                            callbacks: {
                                label: function(context) {
                                    return context.dataset.label + ': ' + context.parsed.y.toFixed(1) + '%';
                                }
                            }
                        }
                    },
                    scales: {
                        y: {
                            beginAtZero: true,
                            max: 100,
                            ticks: {
                                callback: function(value) {
                                    return value + '%';
                                }
                            }
                        }
                    }
                }
            });
        }
        
        // ãƒ•ã‚¡ãƒãƒ«ãƒãƒ£ãƒ¼ãƒˆ
        function initFunnelChart() {
            const ctx = document.getElementById('funnelChart').getContext('2d');
            
            window.funnelChart = new Chart(ctx, {
                type: 'bar',
                data: {
                    labels: ['ãƒªãƒ¼ãƒ‰', 'å•†è«‡', 'ææ¡ˆ', 'äº¤æ¸‰', 'æˆç´„'],
                    datasets: [{
                        label: 'ã‚¹ãƒ†ãƒ¼ã‚¸åˆ¥ä»¶æ•°',
                        data: [1000, 650, 320, 180, 142],
                        backgroundColor: [
                            'rgba(59, 130, 246, 0.8)',
                            'rgba(59, 130, 246, 0.7)',
                            'rgba(59, 130, 246, 0.6)',
                            'rgba(59, 130, 246, 0.5)',
                            'rgba(59, 130, 246, 0.4)'
                        ],
                        borderWidth: 0
                    }]
                },
                options: {
                    indexAxis: 'y',
                    responsive: true,
                    maintainAspectRatio: false,
                    plugins: {
                        legend: {
                            display: false
                        },
                        tooltip: {
                            callbacks: {
                                label: function(context) {
                                    const index = context.dataIndex;
                                    const value = context.parsed.x;
                                    const percentage = index > 0 
                                        ? ((value / context.dataset.data[index - 1]) * 100).toFixed(1) + '%'
                                        : '100%';
                                    return value + 'ä»¶ (' + percentage + ')';
                                }
                            }
                        }
                    },
                    scales: {
                        x: {
                            beginAtZero: true
                        }
                    }
                }
            });
        }
        
        // ãƒ’ãƒ¼ãƒˆãƒãƒƒãƒ—ãƒãƒ£ãƒ¼ãƒˆ
        function initHeatmapChart() {
            const ctx = document.getElementById('heatmapChart').getContext('2d');
            
            // ãƒ’ãƒ¼ãƒˆãƒãƒƒãƒ—ç”¨ã®ãƒ‡ãƒ¼ã‚¿ç”Ÿæˆ
            const hours = Array.from({length: 24}, (_, i) => i + 'æ™‚');
            const days = ['æœˆ', 'ç«', 'æ°´', 'æœ¨', 'é‡‘', 'åœŸ', 'æ—¥'];
            
            const heatmapData = [];
            days.forEach((day, dayIndex) => {
                hours.forEach((hour, hourIndex) => {
                    // å¹³æ—¥ã®å–¶æ¥­æ™‚é–“ã¯é«˜ã„å€¤ã€é€±æœ«ã¨å¤œé–“ã¯ä½ã„å€¤
                    let value = Math.random() * 50;
                    if (dayIndex < 5 && hourIndex >= 9 && hourIndex <= 18) {
                        value += 50;
                    }
                    heatmapData.push({
                        x: hourIndex,
                        y: dayIndex,
                        v: Math.round(value)
                    });
                });
            });
            
            window.heatmapChart = new Chart(ctx, {
                type: 'scatter',
                data: {
                    datasets: [{
                        label: 'å£²ä¸Šé«˜',
                        data: heatmapData,
                        backgroundColor: function(context) {
                            const value = context.raw.v;
                            const alpha = value / 100;
                            return `rgba(99, 102, 241, ${alpha})`;
                        },
                        borderColor: 'transparent',
                        pointRadius: 15
                    }]
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: false,
                    plugins: {
                        legend: {
                            display: false
                        },
                        tooltip: {
                            callbacks: {
                                label: function(context) {
                                    const dayName = days[context.parsed.y];
                                    const hourName = hours[context.parsed.x];
                                    return `${dayName}æ›œæ—¥ ${hourName}: Â¥${context.raw.v}ä¸‡`;
                                }
                            }
                        }
                    },
                    scales: {
                        x: {
                            type: 'linear',
                            position: 'bottom',
                            min: -0.5,
                            max: 23.5,
                            ticks: {
                                stepSize: 1,
                                callback: function(value) {
                                    return hours[value];
                                }
                            }
                        },
                        y: {
                            type: 'linear',
                            min: -0.5,
                            max: 6.5,
                            ticks: {
                                stepSize: 1,
                                callback: function(value) {
                                    return days[value];
                                }
                            }
                        }
                    }
                }
            });
        }
        
        // ãƒ•ã‚£ãƒ«ã‚¿ãƒ¼é©ç”¨
        function applyFilters() {
            // å®Ÿéš›ã®å®Ÿè£…ã§ã¯ã€é¸æŠã•ã‚ŒãŸãƒ•ã‚£ãƒ«ã‚¿ã«åŸºã¥ã„ã¦ãƒ‡ãƒ¼ã‚¿ã‚’å†å–å¾—ã—ã€ãƒãƒ£ãƒ¼ãƒˆã‚’æ›´æ–°
        }
        
        // ãƒ“ãƒ¥ãƒ¼åˆ‡ã‚Šæ›¿ãˆé–¢æ•°
        function switchCohortView(view) {
            document.querySelectorAll('.chart-btn').forEach(btn => btn.classList.remove('active'));
            event.target.classList.add('active');
            // å®Ÿéš›ã®å®Ÿè£…ã§ã¯ã€ãƒ“ãƒ¥ãƒ¼ã«å¿œã˜ã¦ãƒãƒ£ãƒ¼ãƒˆãƒ‡ãƒ¼ã‚¿ã‚’æ›´æ–°
        }
        
        function switchFunnelPeriod(period) {
            document.querySelectorAll('.chart-btn').forEach(btn => btn.classList.remove('active'));
            event.target.classList.add('active');
            // å®Ÿéš›ã®å®Ÿè£…ã§ã¯ã€æœŸé–“ã«å¿œã˜ã¦ãƒ•ã‚¡ãƒãƒ«ãƒ‡ãƒ¼ã‚¿ã‚’æ›´æ–°
        }
        
        // åˆæœŸåŒ–
        document.addEventListener('DOMContentLoaded', function() {
            initCohortChart();
            initFunnelChart();
            initHeatmapChart();
            
            // æ—¥ä»˜ã®åˆæœŸå€¤ã‚’ä»Šæ—¥ã«è¨­å®š
            const today = new Date();
            const firstDay = new Date(today.getFullYear(), today.getMonth(), 1);
            document.getElementById('startDate').value = firstDay.toISOString().split('T')[0];
            document.getElementById('endDate').value = today.toISOString().split('T')[0];
        });
    </script>
</body>
</html>